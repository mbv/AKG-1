<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body onload="init();">
<canvas id="canvas"></canvas>
<script type="application/javascript">
  function draw() {
    var width = window.innerWidth ||
      document.documentElement.clientWidth ||
      document.body.clientWidth;

    var height = window.innerHeight ||
      document.documentElement.clientHeight ||
      document.body.clientHeight;
    canvas.width = width;
    canvas.height = height;
    if (canvas.getContext) {
      var ctx = canvas.getContext('2d');

      var square = {
        width: Math.round(height / 1.2),
        height: Math.round(height / 1.2)
      };
      var startDrawPoint = point(200, 200)


      drawPoints(ctx, startDrawPoint, rectangle, 'rgba(0, 0, 200, 1)');

      circle(ctx, circleX, circleY, 100);
    }
  }

  var circleX = 500;
  var circleY = 500;

  var rectangle;

  var startMoving = false;
  var canvas = document.getElementById('canvas');

  function init() {
    rectangle = {
      data: [
        point(0, 0),
        point(100, 0),
        point(100, 100),
        point(0, 100)
      ],
      getLength: function () {
        return this.data.length;
      },
      getPoint: function (i) {
        return this.data[i % this.data.length]
      }
    };


    draw();

    if (canvas.addEventListener) {

      canvas.addEventListener("click", function (event) {
        startMoving = !startMoving;
      });
      canvas.addEventListener("mousemove", function (event) {
        if (startMoving) {
          circleX = event.clientX;
          circleY = event.clientY;
          bigN = 0;

          intersection(point(200,200), point(300, 200), {
            x: circleX,
            y: circleY,
            radius: 100,
          })
          draw();
        }
      });

    }
  }

  function drawPoints(ctx, startDrawPoint, points, color) {
    for (var i = 0; i < points.getLength(); i++) {
      line(ctx, startDrawPoint, points.getPoint(i), points.getPoint(i + 1), color)
    }
  }

  function point(x, y) {
    return {
      x: x,
      y: y
    }
  }

  function line(ctx, startDrawPoint, p1, p2, color) {
    ctx.strokeStyle = color;
    ctx.beginPath();
    ctx.moveTo(startDrawPoint.x + p1.x, startDrawPoint.y + p1.y);
    ctx.lineTo(startDrawPoint.x + p2.x, startDrawPoint.y + p2.y);
    ctx.closePath();
    ctx.stroke();
  }

  var bigN = 0;

  function plot_circle(ctx, x, y, x_center, y_center, force_draw = false) {
    if ((bigN % 10 < 5) && !force_draw) {
      return
    }
    putpixel(ctx, x_center + x, y_center + y);
    putpixel(ctx, x_center + x, y_center - y);
    putpixel(ctx, x_center - x, y_center + y);
    putpixel(ctx, x_center - x, y_center - y);
  }

  function circle(ctx, x_center, y_center, radius, color) {
    ctx.fillStyle = color;
    var x = 0;
    var y = radius;
    var delta = 3 - 2 * radius;
    while (x < y) {
      plot_circle(ctx, x, y, x_center, y_center);
      plot_circle(ctx, y, x, x_center, y_center);
      bigN++;
      if (delta < 0)
        delta += 4 * x + 6;
      else {
        delta += 4 * (x - y) + 10;
        y--;
      }
      x++;
    }

    if (x === y) plot_circle(ctx, x, y, x_center, y_center, true);
  }


  function putpixel(ctx, x, y) {
    ctx.fillRect(x, y, 1, 1);
  }

  function movePoint(p, d) {
    return point(p.x - d.x, p.y - d.y)
  }


  function intersection(p1, p2, circle) {
    var dX = circle.x;
    var dY = circle.y;
    //console.log(circle);
    //console.log(p1);
    //console.log(p2);
    p1 = movePoint(p1, circle)
    p2 = movePoint(p2, circle)

    var a = p2.y - p1.y;
    var b = p2.x - p1.x;
    var c = p1.x * p2.y - p2.x * p1.y;
    var r = circle.radius;
    var EPS = 0.0001;

    var x0 = -a*c/(a*a+b*b),  y0 = -b*c/(a*a+b*b);
    if (c*c > r*r*(a*a+b*b)+EPS) {
      console.log("none")
      return [];
    }
      //puts ("no points");
    else if (Math.abs (c*c - r*r*(a*a+b*b)) < EPS) {
      return [point(dX + x0, dY + y0)];
      //console.log("One")
      //console.log(point(dX + x0, dY + y0))
      //puts ("1 point");
      //cout << x0 << ' ' << y0 << '\n';
    }
    else {
      var d = r*r - c*c/(a*a+b*b);
      var mult = Math.sqrt (d / (a*a+b*b));

      var pA = point(dX + x0 + b * mult, dY + y0 - a * mult);
      var pB = point(dX + x0 - b * mult, dY + y0 + a * mult);
      return [pA, pB];

      //console.log("Two")
      //console.log(pA)
      //console.log(pB)

      //puts ("2 points");
      //cout << ax << ' ' << ay << '\n' << bx << ' ' << by << '\n';
    }

  }
</script>
</body>
</html>